!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(){this.container=document.getElementById("canvas-container"),this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.setCanvasSizeToWindowSize(),window.addEventListener("resize",t=>{this.setCanvasSizeToWindowSize()})}setCanvasSizeToWindowSize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}get2DContext(){return this.twoDContext||(this.twoDContext=this.canvas.getContext("2d")),this.twoDContext}get width(){return this.canvas.width}get height(){return this.canvas.height}}class n{constructor(t,e){this.x=t,this.y=e}}function o(t,e,i){return t<e?e:t>i?i:t}class a{constructor(t){this.canvas=t,this.ctx=t.get2DContext(),this.setup(),window.addEventListener("resize",t=>{this.setup()})}setup(){this.setDefaultX(),this.setDefaultY()}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}setDefaultX(){this.minX=0,this.maxX=this.canvas.width}setDefaultY(){this.minY=0,this.maxY=this.canvas.height}setBackgroundColor(t){this.ctx.fillStyle=t,this.ctx.fillRect(this.minX,this.minY,this.width,this.height)}fill(t){this.ctx.fillStyle=t,this.ctx.fill()}drawLine(t,e,i,s){this.ctx.strokeStyle=i,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineWidth=s,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}drawCircle(t,e,i){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,2*Math.PI),this.fill(i)}drawRectangle(t,e,i){const s=e.x-t.x,n=e.y-t.y;this.ctx.rect(t.x,t.y,s,n),this.fill(i)}drawText(t,e){this.ctx.font="18px Arial",this.ctx.fillStyle="white",this.ctx.fillText(t,e.x,e.y)}pointWithinBoundaries(t,e){return t=o(t,this.minX,this.maxX),e=o(e,this.minY,this.maxY),new n(t,e)}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}get midY(){return(this.minY+this.maxY)/2}get midX(){return(this.minX+this.maxX)/2}}class r extends a{constructor(t){void 0===t&&(t=new s),super(t)}}const h=21,c=6,l=h+c,d=.5,u=3,m=2;class w{static playAreaPixels(){return window.innerHeight}static playAreaFeet(){return u+h+c+m}static get foot(){return this.playAreaPixels()/this.playAreaFeet()}static get meter(){return this.playAreaPixels()/(.3048*this.playAreaFeet())}static meters(t){return this.meter*t}static feet(t){return this.foot*t}static width(){return 14*this.foot}static halfWidth(){return this.width()/2}static length(){return this.playAreaPixels()}static halfLength(){return this.length()/2}}class g{static verticalOffset(){return 0}static horizontalOffset(){return 0}static centerPositionX(){return this.horizontalOffset()+window.innerWidth/2}static centerPositionY(){return this.verticalOffset()+w.playAreaPixels()/2}static originX(){return this.centerPositionX()-w.halfWidth()}static maxX(){return this.centerPositionX()+w.halfWidth()}static originY(){return this.centerPositionY()-w.halfLength()}static maxY(){return this.centerPositionY()+w.halfLength()}static applyOffsetX(t){return this.horizontalOffset()+t}static applyOffsetY(t){return this.verticalOffset()+t}}function f(t){return g.applyOffsetY(w.feet(t))}class x extends r{setDefaultX(){this.minX=g.originX(),this.maxX=g.maxX()}setDefaultY(){this.minY=g.originY(),this.maxY=g.maxY()}feet(t){return w.feet(t)}render(){this.setBackgroundColor("white"),this.drawBackground()}drawBackground(){this.drawHouse(),this.drawCenterLine(),this.drawHogLine(),this.drawTeeLine(),this.drawBackLine()}drawCenterLine(){const t=new n(this.midX,this.minY),e=new n(this.midX,this.maxY);this.drawLine(t,e,"black",2)}drawHogLine(){const t=f(u);this.drawLine(new n(this.minX,t),new n(this.maxX,t),"black",5)}drawTeeLine(){const t=f(u+h);this.drawLine(new n(this.minX,t),new n(this.maxX,t),"black",2)}drawBackLine(){const t=f(u+l);this.drawLine(new n(this.minX,t),new n(this.maxX,t),"black",2)}drawHouse(){const t=f(u+h),e=new n(this.midX,t);this.drawCircle(e,this.feet(6),"blue"),this.drawCircle(e,this.feet(4),"white"),this.drawCircle(e,this.feet(2),"red"),this.drawCircle(e,this.feet(.75),"white")}}class v extends r{setDefaultX(){const t=w.feet(d);this.minX=g.originX()-t,this.maxX=g.maxX()+t}setDefaultY(){this.minY=g.originY(),this.maxY=g.maxY()}render(t){this.clear();for(let e of t)this.drawStone(e.position,e.color)}drawStone(t,e){this.drawCircle(t,w.feet(d),"grey"),this.drawCircle(t,w.feet(d-.15),e)}}class y extends r{render(t,e,i){const s=new n(15,15),o=new n(260,100);this.drawRectangle(s,o,"#2e3fab");this.drawStones(t,34),this.drawStones(e,59),this.drawText(`team1 - ${t.score} ${t.hasLastStone?"✓":""}`,new n(25,40)),this.drawText(`team2 - ${e.score} ${e.hasLastStone?"✓":""}`,new n(25,65)),this.drawText(`end ${i}`,new n(25,90))}drawStones(t,e){for(let i=0;i<t.stonesRemainingThisEnd;i++)this.drawCircle(new n(130+15*i,e),5,t.color)}}class S{constructor(t){this.color=t,this.endScores=[],this.stonesRemainingThisEnd=8,this.hasLastStone=!1}get score(){return this.endScores.reduce((t,e)=>t+e,0)}awardPoints(t){this.endScores.push(t)}awardNoPoints(){this.endScores.push(0)}goesFirst(){return!this.hasLastStone}}class p extends n{generateRelativeX(t){this.relativeX=(t-g.originX())/w.width()}generateRelativeY(t){this.relativeY=(t-g.originY())/w.length()}get x(){return this.relativeX*w.width()+g.originX()}get y(){return this.relativeY*w.length()+g.originY()}set x(t){this.generateRelativeX(t)}set y(t){this.generateRelativeY(t)}}function P(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}const X=-.15,T=new n(g.centerPositionX(),f(h));class M{constructor(t,e){var i;this.intendedPosition=new p(t.x,t.y),this.position=new p(t.x,g.originY()),this.color=e.color,this.team=e,this.direction=90,this.velocity=(i=(this.intendedPosition.y-f(u))/w.meter,Math.sqrt(-1*X*2*i)*w.meter)}isMoving(){return this.velocity>0}move(t){if(this.isMoving()){const e=this.pixelsPerSecondToMS(this.velocity,t);this.movePixelsInDirection(e),this.position.y>f(u)&&(this.slowDown(t),this.rotate(t))}}slowDown(t){const e=this.velocity/w.meter,i=this.pixelsPerSecondToMS(X,t);this.velocity=(e+i)*w.meter,this.velocity<0&&(this.velocity=0)}rotate(t){this.direction}pixelsPerSecondToMS(t,e){return t/1e3*e}movePixelsInDirection(t,e=this.direction){this.position=function(t,e,i){const s=i/180-.5;return new t.constructor(t.x+e*s,t.y+e*(1-s))}(this.position,t,e)}inBounds(){const t=w.feet(d);return!(this.position.y-t<f(u)&&!this.isMoving())&&(!(this.position.y+t>f(u+l))&&(!(this.position.x-t<=g.originX())&&!(this.position.x+t>=g.maxX())))}inHouse(){return this.distanceToButton()+w.feet(d)<w.feet(12)}distanceToButton(){return P(this.position,T)}}class Y{constructor(){this.stonesInPlay=[]}noMovingStones(){for(let t of this.stonesInPlay)if(t.isMoving())return!1;return!0}addStone(t,e){if(this.noMovingStones()){const i=new M(t,e);this.stonesInPlay.push(i)}}clearStones(){this.stonesInPlay=[]}removeOutOfBoundsStones(){this.stonesInPlay=this.stonesInPlay.filter(t=>t.inBounds())}}class L{constructor(t,e,i){this.team1=t,this.team2=e,this.stoneManager=i,this.currentEnd=1,this.setupEnd()}setCurrentTeam(){this.currentTeam=this.team1.goesFirst()?this.team1:this.team2}changeTeam(){this.currentTeam==this.team1?this.currentTeam=this.team2:this.currentTeam=this.team1}setupEnd(){this.setCurrentTeam(),this.stoneManager.clearStones(),this.team1.stonesRemainingThisEnd=8,this.team2.stonesRemainingThisEnd=8}noTurnsRemain(){return!(this.team1.stonesRemainingThisEnd+this.team2.stonesRemainingThisEnd)}takeTurn(t){this.stoneManager.noMovingStones()&&(this.noTurnsRemain()&&this.completeEnd(),this.stoneManager.addStone(t,this.currentTeam),this.currentTeam===this.team1?this.team1.stonesRemainingThisEnd--:this.team2.stonesRemainingThisEnd--,this.changeTeam())}completeEnd(){this.scoreEnd(),this.setupEnd(),this.currentEnd++}scoreEnd(){const t=this.stonesInHouse();if(0===t.length)return void this.blankEnd();let e=1;for(;t[e-1].team===t[e].team;)e++;this.awardPoints(t[0].team,e)}stonesInHouse(){return this.stoneManager.stonesInPlay.filter(t=>t.inHouse()).sort((t,e)=>t.distanceToButton()-e.distanceToButton())}blankEnd(){this.team1.awardNoPoints(),this.team2.awardNoPoints()}awardPoints(t,e){t.awardPoints(e),t.hasLastStone=!1;const i=t===this.team1?this.team2:this.team1;i.awardNoPoints(),i.hasLastStone=!0}}const B=w.feet(2*d);class C{static collideAll(t){for(let e of t)if(e.isMoving())for(let i of t)this.canCollide(e,i)&&new E(e,i)}static canCollide(t,e){return t!==e&&!e.isMoving()}}class E{setDistanceBetweenStones(){this.distanceBetweenStones=P(this.movingStone.position,this.stationaryStone.position)}setAngleBetweenStones(){this.angleBetweenStones=function(t,e){let i=Math.atan2(e.x-t.x,e.y-t.y)+Math.PI/2;return i<0&&(i=Math.abs(i)),57.29577951308232*i}(this.movingStone.position,this.stationaryStone.position)}constructor(t,e){this.movingStone=t,this.stationaryStone=e,this.setDistanceBetweenStones(),this.collision=this.checkIfStonesAreTouching(),this.collision&&this.collideStones()}checkIfStonesAreTouching(){return this.distanceBetweenStones<=B}collideStones(){this.moveStoneForSolidImpact(),this.setValuesForCollision(),this.effectVelocity(),this.effectDirection()}moveStoneForSolidImpact(){if(this.distanceBetweenStones<B){const t=B-this.distanceBetweenStones,e=-1*(this.movingStone.direction-180);this.movingStone.movePixelsInDirection(t,e)}}setValuesForCollision(){this.setDistanceBetweenStones(),this.setAngleBetweenStones()}effectVelocity(){const t=this.percentOfCollision();this.stationaryStone.velocity=this.movingStone.velocity*(1-t),this.movingStone.velocity=this.movingStone.velocity*t}percentOfCollision(){const t=(this.angleBetweenStones-90+this.movingStone.direction)/180*Math.PI,e=Math.cos(t)*this.distanceBetweenStones;return Math.abs(e)/B}effectDirection(){this.stationaryStone.direction=this.angleBetweenStones,this.movingStone.direction=180-this.angleBetweenStones}}const R=new class{setup(){this.canvas=new s,this.mainLayer=new r(this.canvas),this.sheetLayer=new x(this.canvas),this.stonesLayer=new v,this.scoreBoardLayer=new y;const t=new S("darkred"),e=new S("yellow");this.teams=[t,e],this.determineFirstPlayer(),this.stoneManager=new Y,this.endManager=new L(t,e,this.stoneManager),this.initialRender()}determineFirstPlayer(){this.teams[Math.round(Math.random())].hasLastStone=!0}initialRender(){this.mainRender(),this.auxilaryRender()}auxilaryRender(){this.mainLayer.setBackgroundColor("#222641"),this.sheetLayer.render()}mainRender(){this.stonesLayer.render(this.stoneManager.stonesInPlay),this.scoreBoardLayer.render(this.teams[0],this.teams[1],this.endManager.currentEnd)}start(){this.bindEvents(),this.lastFrameTime=0,window.requestAnimationFrame(this.loop.bind(this))}bindEvents(){document.addEventListener("click",t=>{const e=this.stonesLayer.pointWithinBoundaries(t.clientX,t.clientY);this.endManager.takeTurn(e)}),window.addEventListener("resize",t=>{this.auxilaryRender(),this.mainRender()})}loop(t){const e=this.handleDroppedFrames(t-this.lastFrameTime);this.updateGameState(e),this.mainRender(),this.lastFrameTime=t,window.requestAnimationFrame(this.loop.bind(this))}updateGameState(t){for(let e of this.stoneManager.stonesInPlay)e.move(t),this.stoneManager.removeOutOfBoundsStones(),C.collideAll(this.stoneManager.stonesInPlay)}handleDroppedFrames(t){return t<1e3?t:15}};R.setup(),R.start()}]);
//# sourceMappingURL=main.js.map